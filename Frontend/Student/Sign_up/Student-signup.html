<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Signup_style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</head>

<body>
    <header>
        <div class="logo">
            <h2>Work Hub</h2>
        </div>
        <nav class="navi">
            <ul>
                <li><a href="#" class="menu_btn">Find Job</a></li>
                <li><a href="#" class="menu_btn"><span><ion-icon name="reader-outline"></ion-icon></span>My CV</a></li>
                <li><a href="#" class="menu_btn"><span><ion-icon
                                name="notifications-outline"></ion-icon></span>Notification</a></li>
                <li><a href="#" class="menu_btn"><span><ion-icon
                                name="person-circle-outline"></ion-icon></span>Account</a></li>
                <li><a href="../Login/Login.html"><button type="button" class="btn_login"
                            value="Login">Login</button></a></li>
            </ul>
        </nav>

    </header>

    <main>
        <div class="signup_box">
            <h2>SIGN UP</h2>
            <h4>Step 2</h4> <br>
            <form action="" id="signup-form-step2" method="get">

                <div class="info">
                    <label>Full Name</label>
                    <input type="text" id="fullname" placeholder="VD: Nguyễn Văn A" required autocomplete="on" autofocus>
                </div>

                <div class="info">
                    <label>Birthday</label>
                    <input type="date" id="birthday" placeholder="Birthday" required>
                </div>

                <div class="radio">
                    <label>Gender</label>
                    <label for="Male"><input type="radio" name="gender" value="Male" id="Male"> Male</label>
                    <label for="Female"><input type="radio" name="gender" value="Female" id="Female"> Female</label>
                </div>
                <div id="error-message-gender" class="error-message"></div>

                <div class="info">
                    <label>Address</label>
                    <input type="text" id="address" placeholder="Address" required>
                </div>

                <div class="info">
                    <label>Phone number</label>
                    <input type="tel" id="phone-number" placeholder="Phone number" pattern="0[0-9]{9}" required>
                </div>

                <div class="signup_btn">
                    <input type="submit" name="btnSignUp" id="btnSignUp" value="Sign Up">
                </div>

            </form>
        </div>
    </main>

    <script>
        //kiểm tra điền giới tính chưa
        function validateInfo(gender) {
            let valid = true;
            let errorMessageGender = document.getElementById('error-message-gender');
            if (gender === null) {
                errorMessageGender.innerHTML = "<p>Please choose your gender!</p>";
                valid = false;
            }
            return valid;
        }
        document.getElementById('signup-form-step2').addEventListener('submit', function (event) {
            event.preventDefault();

            let fullName = document.getElementById('fullname').value;
            let birthday = document.getElementById('birthday').value;
            let gender = document.querySelector('input[name="gender"]:checked');
            let address = document.getElementById('address').value;
            let phoneNumber = document.getElementById('phone-number').value;
            if (!validateInfo(gender)) {
                return;
            }

            let list_user = JSON.parse(localStorage.getItem('list_user')) || { list_student: [], list_employer: [] };
            let currentUser = JSON.parse(localStorage.getItem('user')) ;

            if (!currentUser) {
                alert("No user found. Sign up again!");
                window.location.href= 'Signup-role.html';
                
            }

            let studentIndex = list_user.list_student.findIndex(
                student =>
                student.email === currentUser.email && 
                student.password === currentUser.password && 
                student.role === currentUser.role
            );

            //kiểm tra xem đã làm bước 1 chưa
            

            //nếu có thì điền thông tin, lưu dữ liệu
            if (studentIndex !== -1) {
                list_user.list_student[studentIndex].fullName = fullName;
                list_user.list_student[studentIndex].birthday = birthday;
                list_user.list_student[studentIndex].gender = gender.value;
                list_user.list_student[studentIndex].address = address;
                list_user.list_student[studentIndex].phoneNumber = phoneNumber;
                list_user.list_student[studentIndex].step = 2;

                localStorage.setItem('list_user', JSON.stringify(list_user));
                localStorage.removeItem('user');
                window.location.href = '../Login/login.html';
            }
        })
    </script>
</body>

</html>